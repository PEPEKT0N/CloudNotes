---
description: Current tasks and bugs to fix in CloudNotes
globs: 
alwaysApply: true
---

# CloudNotes - Текущие задачи

## Критические баги

### 1. Починить синхронизацию
- ✅ Исправлено сохранение контента заметок при переключении через дерево
- ✅ Добавлен auto-save в SelectedTreeItem сеттер (NotesViewModel.cs)
- ✅ Исправлен IsSynced флаг - локальные изменения помечаются для загрузки на сервер
- ✅ Добавлена таблица DeletedNotes для отслеживания удалённых заметок

### 2. Починить сортировку
- Сортировка заметок работает некорректно

### 3. Починить теги
- Теги отображаются после sign out (должны скрываться или очищаться)

### 4. Починить Study by Tag
- Функция "Study by Tag" не работает

### 5. Исправить размер кнопки Preview
- ✅ Увеличена ширина кнопки чтобы "Preview" было видно полностью

## Контекст синхронизации

Ключевые файлы:
- `src/CloudNotes.Desktop/Services/SyncService.cs` - основная логика синхронизации
- `src/CloudNotes.Desktop/Services/NoteService.cs` - CRUD операции с заметками
- `src/CloudNotes.Desktop/Model/DeletedNote.cs` - отслеживание удалённых заметок

Логика синхронизации:
1. При logout вызывается SyncAsync() для отправки изменений на сервер
2. При login вызывается SyncOnStartupAsync() для загрузки данных с сервера
3. Локальные заметки с IsSynced=false отправляются на сервер
4. Серверные заметки создаются/обновляются локально
