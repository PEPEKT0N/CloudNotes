<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:CloudNotes.Desktop.Converters"
             xmlns:vm="clr-namespace:CloudNotes.Desktop.ViewModel"
             x:Class="CloudNotes.Desktop.Views.NoteListView"
             Focusable="True"
             >

        <Border Padding="20">
            <StackPanel>
                <!-- Header Ñ hamburger menu -->
                <Grid ColumnDefinitions="Auto, *" Margin="0,0,0,10">
                    <Button Grid.Column="0"
                            x:Name="HamburgerButton"
                            Content="â˜°"
                            FontSize="18"
                            Background="Transparent"
                            BorderThickness="0"
                            Padding="5,2"
                            VerticalAlignment="Center">
                        <Button.Flyout>
                            <MenuFlyout Placement="BottomEdgeAlignedLeft">
                                <!-- Email (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð³Ð´Ð° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð¾Ð²Ð°Ð½) -->
                                <MenuItem x:Name="UserEmailMenuItem" Header="ðŸ“§ user@email.com" IsEnabled="False" IsVisible="False" />
                                <Separator x:Name="EmailSeparator" IsVisible="False" />
                                <!-- Ð’ÑÐµÐ³Ð´Ð° Ð²Ð¸Ð´Ð½Ñ‹ -->
                                <MenuItem x:Name="SignInMenuItem" Header="ðŸ”‘ Log in / Sign up" />
                                <MenuItem x:Name="LogoutMenuItem" Header="ðŸšª Sign out" IsEnabled="False" />
                            </MenuFlyout>
                        </Button.Flyout>
                    </Button>
                    
                    <TextBlock Grid.Column="1"
                               Text="CloudNotes"
                               FontSize="20"
                               FontWeight="Bold"
                               VerticalAlignment="Center"
                               Margin="10,0,0,0" />
                </Grid>

                <Button Margin="0.5"
                        Content="Create note"
                        Command="{Binding CreateNoteCommand}" />

                <!-- Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° (Ð²Ð»Ð¸ÑÐµÑ‚ Ð½Ð° Ð¾Ð±Ð° ÑÐ¿Ð¸ÑÐºÐ°) -->
                <StackPanel Orientation="Horizontal" Margin="0,15,0,0" HorizontalAlignment="Right">
                    <TextBlock Text="Sort by"
                               FontSize="12"
                               VerticalAlignment="Center"
                               Margin="0,0,5,0"
                               Opacity="0.7" />
                    <ComboBox ItemsSource="{Binding SortOptions}"
                              SelectedItem="{Binding SelectedSortOption}"
                              MinWidth="100"
                              FontSize="12">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Converter={x:Static local:SortOptionConverter.Instance}}" />
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </StackPanel>

                <TextBlock Text="Favorites"
                            FontWeight="Bold"
                            FontSize="16"
                            Margin="0,10,0,10" />

                <ListBox ItemsSource="{Binding Favorites}"
                         SelectedItem="{Binding SelectedFavoriteItem, Mode=TwoWay}"
                         SelectionChanged="OnFavoritesSelectionChanged"
                         MaxHeight="200">
                    <ListBox.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Remove from favorites"
                                        Command="{Binding RemoveFromFavoritesCommand}" />
                            <MenuItem Header="Rename" Click="OnRenameMenuClick" />
                            <MenuItem Header="Delete"
                                        Command="{Binding DeleteNoteCommand}" />
                        </ContextMenu> 
                    </ListBox.ContextMenu>

                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Title}" />
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>


                <!-- Folders section -->
                <TextBlock Text="Folders"
                           FontWeight="Bold"
                           FontSize="16"
                           Margin="0,20,0,10" />

                <StackPanel Orientation="Horizontal" Spacing="5" Margin="0,0,0,5">
                    <Button Content="ðŸ“ New Folder"
                            Command="{Binding CreateFolderCommand}"
                            FontSize="12" />
                    <Button x:Name="ShowAllButton"
                            Content="ðŸ“‚ Show All"
                            Command="{Binding ClearFolderSelectionCommand}"
                            FontSize="12" />
                </StackPanel>

                <TreeView x:Name="FolderTreeView"
                         ItemsSource="{Binding Folders}"
                         SelectedItem="{Binding SelectedFolder, Mode=TwoWay}"
                         MaxHeight="200"
                         SelectionChanged="OnFolderSelectionChanged">
                    <TreeView.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="New Folder"
                                        Command="{Binding CreateFolderCommand}" />
                            <MenuItem Header="Rename"
                                        Command="{Binding RenameFolderCommand}" />
                            <MenuItem Header="Delete"
                                        Command="{Binding DeleteFolderCommand}" />
                        </ContextMenu>
                    </TreeView.ContextMenu>
                    <TreeView.ItemTemplate>
                        <TreeDataTemplate ItemsSource="{Binding Children}">
                            <TextBlock Text="{Binding Name}" />
                        </TreeDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>

                <TextBlock Text="Your Notes"
                           FontWeight="Bold"
                           FontSize="16"
                           Margin="0,20,0,10" />

                <ListBox ItemsSource="{Binding Notes}"
                         SelectedItem="{Binding SelectedListItem, Mode=TwoWay}"
                         SelectionChanged="OnListBoxSelectionChanged"
                         MaxHeight="300">

                    <ListBox.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Add to favorites"
                                        Command="{Binding AddToFavoritesCommand}" />
                            <MenuItem Header="Rename" Click="OnRenameMenuClick" />
                            <MenuItem Header="Move to folder..."
                                        Command="{Binding MoveNoteToFolderCommand}" />
                            <Separator />
                            <MenuItem Header="Delete"
                                        Command="{Binding DeleteNoteCommand}" />
                        </ContextMenu>
                    </ListBox.ContextMenu>

                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Title}" />
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Tags section -->
                <TextBlock Text="Tags"
                           FontWeight="Bold"
                           FontSize="16"
                           Margin="0,20,0,10" />

                <ItemsControl ItemsSource="{Binding AllTags}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button Content="{Binding Name}"
                                    Command="{Binding $parent[UserControl].((vm:NotesViewModel)DataContext).FilterByTagCommand}"
                                    CommandParameter="{Binding}"
                                    Margin="0,0,5,5"
                                    Padding="8,4"
                                    FontSize="12"
                                    Background="#E0E0E0"
                                    CornerRadius="10" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Clear filter button -->
                <Button Content="Show all notes"
                        Command="{Binding ClearTagFilterCommand}"
                        IsVisible="{Binding IsFilteredByTag}"
                        Margin="0,5,0,0"
                        FontSize="12"
                        HorizontalAlignment="Left" />
            </StackPanel>
        </Border>

    

</UserControl>