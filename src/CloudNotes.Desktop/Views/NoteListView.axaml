<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:CloudNotes.Desktop.Converters"
             xmlns:vm="clr-namespace:CloudNotes.Desktop.ViewModel"
             x:Class="CloudNotes.Desktop.Views.NoteListView"
             Focusable="True"
             >

        <Border Padding="10">
            <StackPanel>
                <!-- Header Ñ hamburger menu -->
                <Grid ColumnDefinitions="Auto, *" Margin="0,0,0,10">
                    <Button Grid.Column="0"
                            x:Name="HamburgerButton"
                            Content="â˜°"
                            FontSize="18"
                            Background="Transparent"
                            BorderThickness="0"
                            Padding="5,2"
                            VerticalAlignment="Center">
                        <Button.Flyout>
                            <MenuFlyout Placement="BottomEdgeAlignedLeft">
                                <!-- Email (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð³Ð´Ð° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð¾Ð²Ð°Ð½) -->
                                <MenuItem x:Name="UserEmailMenuItem" Header="ðŸ“§ user@email.com" IsEnabled="False" IsVisible="False" />
                                <Separator x:Name="EmailSeparator" IsVisible="False" />
                                <!-- Ð’ÑÐµÐ³Ð´Ð° Ð²Ð¸Ð´Ð½Ñ‹ -->
                                <MenuItem x:Name="SignInMenuItem" Header="ðŸ”‘ Log in / Sign up" />
                                <MenuItem x:Name="LogoutMenuItem" Header="ðŸšª Sign out" IsEnabled="False" />
                            </MenuFlyout>
                        </Button.Flyout>
                    </Button>
                    
                    <TextBlock Grid.Column="1"
                               Text="CloudNotes"
                               FontSize="16"
                               FontWeight="Bold"
                               VerticalAlignment="Center"
                               Margin="10,0,0,0" />
                </Grid>

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð·Ð°Ð¼ÐµÑ‚ÐºÐ¸ Ð¸ Ð¿Ð°Ð¿ÐºÐ¸ -->
                <StackPanel Orientation="Vertical" Spacing="3" Margin="0,0,0,10">
                    <Button Content="ðŸ“ Create note"
                            Command="{Binding CreateNoteCommand}"
                            FontSize="10"
                            Padding="5,3" />
                    <Button Content="ðŸ“ Create folder"
                            Command="{Binding CreateFolderCommand}"
                            FontSize="10"
                            Padding="5,3" />
                </StackPanel>

                <!-- Ð•Ð´Ð¸Ð½Ð¾Ðµ Ð´ÐµÑ€ÐµÐ²Ð¾ Ð¿Ð°Ð¿Ð¾Ðº Ð¸ Ð·Ð°Ð¼ÐµÑ‚Ð¾Ðº -->
                <TreeView x:Name="MainTreeView"
                         ItemsSource="{Binding TreeItems}"
                         SelectedItem="{Binding SelectedTreeItem, Mode=TwoWay}"
                         SelectionChanged="OnTreeViewSelectionChanged">
                    <TreeView.ContextMenu>
                        <ContextMenu x:Name="TreeViewContextMenu" Opening="OnContextMenuOpening">
                            <MenuItem x:Name="NewFolderMenuItem" Header="ðŸ“ New Folder" Click="OnNewFolderMenuClick" />
                            <MenuItem x:Name="NewNoteMenuItem" Header="ðŸ“ New Note" Click="OnNewNoteMenuClick" />
                            <Separator x:Name="FolderSeparator" />
                            <MenuItem x:Name="RenameMenuItem" Header="âœï¸ Rename" Click="OnRenameMenuClick" />
                            <MenuItem x:Name="DeleteMenuItem" Header="ðŸ—‘ï¸ Delete" Click="OnDeleteMenuClick" />
                            <Separator x:Name="NoteSeparator" />
                            <MenuItem x:Name="AddToFavoritesMenuItem" Header="â­ Add to favorites" Click="OnAddToFavoritesMenuClick" />
                            <MenuItem x:Name="MoveToFolderMenuItem" Header="ðŸ“ Move to folder..." Click="OnMoveToFolderMenuClick" />
                        </ContextMenu>
                    </TreeView.ContextMenu>
                    <TreeView.ItemTemplate>
                        <TreeDataTemplate ItemsSource="{Binding Children}">
                            <StackPanel Orientation="Horizontal" Margin="0,1">
                                <TextBlock Text="{Binding Icon}" 
                                          FontSize="12"
                                          VerticalAlignment="Center"
                                          Margin="0,0,5,0" />
                                <TextBlock Text="{Binding Name}" 
                                          FontSize="10"
                                          VerticalAlignment="Center" />
                            </StackPanel>
                        </TreeDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>

                <!-- Favorites section (ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾Ð¹ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚Ð¸) -->
                <TextBlock Text="Favorites"
                            FontWeight="Bold"
                            FontSize="12"
                            Margin="0,15,0,5" />

                <ListBox ItemsSource="{Binding Favorites}"
                         SelectedItem="{Binding SelectedFavoriteItem, Mode=TwoWay}"
                         SelectionChanged="OnFavoritesSelectionChanged"
                         MaxHeight="150">
                    <ListBox.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Remove from favorites"
                                        Command="{Binding RemoveFromFavoritesCommand}" />
                            <MenuItem Header="Rename" Click="OnRenameMenuClick" />
                            <MenuItem Header="Delete"
                                        Command="{Binding DeleteNoteCommand}" />
                        </ContextMenu> 
                    </ListBox.ContextMenu>

                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Title}" FontSize="10" />
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Tags section -->
                <TextBlock Text="Tags"
                           FontWeight="Bold"
                           FontSize="12"
                           Margin="0,15,0,5" />

                <ItemsControl ItemsSource="{Binding AllTags}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button Content="{Binding Name}"
                                    Command="{Binding $parent[UserControl].((vm:NotesViewModel)DataContext).FilterByTagCommand}"
                                    CommandParameter="{Binding}"
                                    Margin="0,0,3,3"
                                    Padding="6,2"
                                    FontSize="10"
                                    Background="#E0E0E0"
                                    CornerRadius="8" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Clear filter button -->
                <Button Content="Show all notes"
                        Command="{Binding ClearTagFilterCommand}"
                        IsVisible="{Binding IsFilteredByTag}"
                        Margin="0,5,0,0"
                        FontSize="10"
                        Padding="5,2"
                        HorizontalAlignment="Left" />
            </StackPanel>
        </Border>

    

</UserControl>